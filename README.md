# FpsMonitor

WPF（C#）で実装した **軽量 FPS / フレーム落ち監視ツール** です。  
高頻度に更新される状態を UI に安全・効率的に表示することを目的に作成しています。

---

## 概要

このアプリケーションは、WPF の描画タイミングを利用してフレーム間隔を計測し、

- 瞬間 FPS
- 短期平均 FPS（10秒）
- 中期平均 FPS（30秒）
- フレーム落ちの連続発生

をリアルタイムに表示します。

UI 更新は低頻度に抑え、高頻度計測と分離することで  
**UI スレッドへの負荷を最小化** しています。

---

## 設計方針

### 1. 高頻度計測と UI 更新の分離

| 処理 | 使用技術 | 更新頻度 |
|----|----|----|
| フレーム計測 | `CompositionTarget.Rendering` | 描画ごと（高頻度） |
| UI 更新 | `DispatcherTimer` | 約 100ms |

高頻度で状態を収集し、  
UI への反映は間引くことで表示の安定性を確保しています。

---

### 2. FPS 計測について

本アプリで計測している FPS は、

> **「WPF の Rendering イベントが呼ばれた間隔」**

を元に算出したものです。

- GPU が実際に画面に表示したフレーム数そのものではありません
- UI スレッドのスケジューリングや OS の影響を受けます

そのため、60Hz 環境でも一時的に 65〜75fps 程度の値が表示されることがあります。  
これは **計測誤りではなく、フレーム間隔の揺らぎによる正常な挙動** です。

---

### 3. 平均 FPS の算出

瞬間 FPS はブレが大きいため、以下の移動平均を併用しています。

- **10秒平均**（短期の体感確認用）
- **30秒平均**（安定した傾向把握用）

また、計測上の揺らぎによる異常値を避けるため、
**外れ値（極端に高い FPS）を除外** した上で平均を算出しています。

---

### 4. フレーム落ち検出

- FPS が一定値（例：60fps）を下回った状態が
- 連続して発生した場合に「フレーム落ち」と判定

瞬間的な揺らぎではなく、  
**体感に影響するレベルの低下のみを検出** する設計です。

---

## 構成
```text
FpsMonitor/
├─ .gitignore
├─ App.xaml
├─ App.xaml.cs
├─ AssemblyInfo.cs
├─ FpsMonitor.csproj
├─ FpsMonitor.csproj.user
├─ FpsMonitor.slnx
├─ MainWindow.xaml
├─ MainWindow.xaml.cs
├─ README.md
├─ RollingAverage.cs
└─ Core/
   ├─ FpsCounter.cs
   ├─ FrameDropDetector.cs
   └─ FrameState.cs
```

---

## 使用技術

- C#
- WPF (.NET)
- `CompositionTarget.Rendering`
- `DispatcherTimer`
- 移動平均（リングバッファ方式）

外部ライブラリは使用していません。

---

## 制限事項

- モニタのリフレッシュレートや GPU の実フレーム数を直接取得するものではありません
- DirectX / DXGI / ETW レベルの計測は行っていません
- 高精度な GPU FPS を求める用途には向きません

本ツールは **UI 描画負荷や体感パフォーマンスの監視** を目的としています。

---

## 想定用途

- WPF アプリの描画負荷確認
- UI 更新頻度のチューニング
- フレーム落ちの検知
- 高頻度状態更新のサンプル実装

---

## ライセンス

MIT License  
自由に改変・利用可能です。
